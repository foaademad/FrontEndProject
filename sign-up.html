<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sign Up - BookHaven</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
    <link rel="stylesheet" href="src/css/variables.css" />
    <link rel="stylesheet" href="src/css/global.css" />
    <link rel="stylesheet" href="src/css/auth.css" />
  </head>
  <body>
    <div class="auth-container">
      <div class="container">
        <div class="row justify-content-center align-items-center min-vh-100">
          <div class="col-md-5">
            <div class="auth-card">
              <!-- Logo and Title -->
              <div class="text-center mb-4">
       
                <h4 class="auth-title">Sign up to BookHaven</h4>
              </div>

              <!-- Social Login -->
              <div class="social-buttons">
                <button class="social-btn">
                  <img src="src/images/facebook.svg" alt="Facebook" />
                </button>
                <button class="social-btn">
                  <img src="src/images/google.svg" alt="Google" />
                </button>
                <button class="social-btn">
                  <img src="src/images/apple.svg" alt="Apple" />
                </button>
              </div>

              <div class="divider">
                <span>or do via email</span>
              </div>

              <!-- Signup Form -->
              <form class="auth-form" id="signupForm" novalidate>
                <div class="row">
                  <div class="col-md-6 mb-3">
                    <div class="form-floating mb-3">
                      <input
                        type="text"
                        class="form-control"
                        id="firstName"
                        placeholder="First Name"
                        required
                      />
                      <label for="firstName">First Name</label>
                      <div class="invalid-feedback">Please enter your first name</div>
                    </div>
                  </div>
                  <div class="col-md-6 mb-3">
                    <div class="form-floating mb-3">
                      <input
                        type="text"
                        class="form-control"
                        id="lastName"
                        placeholder="Last Name"
                        required
                      />
                      <label for="lastName">Last Name</label>
                      <div class="invalid-feedback">Please enter your last name</div>
                    </div>
                  </div>
                </div>

                <div class="form-floating mb-3">
                  <input
                    type="date"
                    class="form-control"
                    id="birthday"
                    placeholder="Birthday"
                    required
                  />
                  <label for="birthday">Birthday</label>
                  <div class="invalid-feedback">Please select your birthday</div>
                </div>

                <div class="form-floating mb-3">
                  <select class="form-select" id="gender" aria-label="Gender" required>
                    <option selected disabled value="">Select gender</option>
                    <option value="male">Male</option>
                    <option value="female">Female</option>
                  </select>
                  <label for="gender">Gender</label>
                  <div class="invalid-feedback">Please select your gender</div>
                </div>

                <div class="row">
                  <div class="col-md-6 mb-3">
                    <div class="form-floating mb-3">
                      <input
                        type="email"
                        class="form-control"
                        id="email"
                        placeholder="name@example.com"
                        required
                      />
                      <label for="email">Email address</label>
                      <div class="invalid-feedback">Please enter a valid email address</div>
                    </div>
                  </div>
                  <div class="col-md-6 mb-3">
                    <div class="form-floating mb-3">
                      <input
                        type="tel"
                        class="form-control"
                        id="phone"
                        placeholder="Phone Number"
                        required
                      />
                      <label for="phone">Phone Number</label>
                      <div class="invalid-feedback">Please enter a valid phone number</div>
                    </div>
                  </div>
                </div>

                <div class="row">
                  <div class="col-md-6 mb-3">
                    <div class="password-field form-floating mb-3">
                      <input
                        type="password"
                        class="form-control"
                        id="password"
                        placeholder="Password"
                        required
                      />
                      <label for="password">Password</label>
                      <button type="button" class="password-toggle">
                        <i class="far fa-eye"></i>
                      </button>
                      <div class="invalid-feedback">Password must be at least 8 characters and contain uppercase, lowercase, numbers, and special characters</div>
                    </div>
                  </div>
                  <div class="col-md-6 mb-3">
                    <div class="password-field form-floating mb-3">
                      <input
                        type="password"
                        class="form-control"
                        id="confirmPassword"
                        placeholder="Confirm Password"
                        required
                      />
                      <label for="confirmPassword">Confirm Password</label>
                      <button type="button" class="password-toggle">
                        <i class="far fa-eye"></i>
                      </button>
                      <div class="invalid-feedback">Passwords do not match</div>
                    </div>
                  </div>
                </div>

                <div class="form-floating mb-3">
                  <select class="form-select" id="role" aria-label="Role" required>
                    <option selected disabled value="">Select role</option>
                    <option value="client">Customer</option>
                    <option value="seller">Seller</option>
                  </select>
                  <label for="role">Role</label>
                  <div class="invalid-feedback">Please select a role</div>
                </div>

                <button type="submit" class="btn btn-auth w-100">
                  Sign up
                </button>
              </form>

              <div class="text-center mt-4">
                <p class="auth-link">
                  Have an account? <a href="sign-in.html">Sign in</a>
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
   
    <script>
      // Retrieve users from localStorage or initialize an empty array
      const usersStorage = localStorage.getItem("users");
      const users = usersStorage ? JSON.parse(usersStorage) : [];
    
      // Check if the user email already exists
      const isEmailExists = (email) => users.find((user) => user.email === email);
    
      // Handle form submission
      $("#signupForm").on("submit", function (e) {
        e.preventDefault();
    
        let isValid = true;
        const formData = {
          firstName: $("#firstName").val(),
          lastName: $("#lastName").val(),
          birthday: $("#birthday").val(),
          gender: $("#gender").val(),
          email: $("#email").val(),
          phone: $("#phone").val(),
          password: $("#password").val(),
          role: $("#role").val(),
        };
    
        // Clear previous invalid states
        $('input, select').removeClass('is-invalid');
        
        // Check for empty fields
        for (const key in formData) {
          if (!formData[key]) {
            $(`#${key}`).addClass('is-invalid');
            isValid = false;
          }
        }
    
        // Validate email
        const emailInput = $('#email');
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (emailInput.val() && !emailRegex.test(emailInput.val())) {
          emailInput.addClass('is-invalid');
          isValid = false;
        }
    
        // Validate phone
        const phoneInput = $('#phone');
        const egyptPhoneRegex = /^(01)[0-2,5]{1}[0-9]{8}$/;
        if (phoneInput.val() && !egyptPhoneRegex.test(phoneInput.val().replace(/\D/g, ''))) {
          phoneInput.addClass('is-invalid');
          isValid = false;
        }
    
        // Check for duplicate email
        if (isEmailExists(formData.email)) {
          emailInput.addClass('is-invalid');
          alert("Email already exists! Please use a different email.");
          isValid = false;
        }
    
        // Password validation
        const passwordInput = $('#password');
        const confirmInput = $('#confirmPassword');
        const password = passwordInput.val();
        const confirm = confirmInput.val();
    
        // Password strength validation
        if (password) {
          const hasMinLength = password.length >= 8;
          const hasUpperCase = /[A-Z]/.test(password);
          const hasLowerCase = /[a-z]/.test(password);
          const hasNumbers = /\d/.test(password);
          const hasSpecialChar = /[!@#$%^&*(),.?":{}|<>]/.test(password);
    
          if (!hasMinLength || !hasUpperCase || !hasLowerCase || !hasNumbers || !hasSpecialChar) {
            passwordInput.addClass('is-invalid');
            passwordInput.siblings('.invalid-feedback').text(
              'Password must be at least 8 characters and contain uppercase, lowercase, numbers, and special characters'
            );
            isValid = false;
          }
        }
    
        // Confirm password validation
        if (confirm && password !== confirm) {
          confirmInput.addClass('is-invalid');
          isValid = false;
        }
    
        // If everything is valid, proceed with registration
        if (isValid) {
          // Add new user and update localStorage
          users.push(formData);
          localStorage.setItem("users", JSON.stringify(users));
    
          // Clear the form and show success message
          $("#signupForm")[0].reset();
          alert("User registered successfully!");
          window.location.href = "sign-in.html";
        }
      });
    
      $(document).ready(function() {
        // Password visibility toggle
        $('.password-toggle').click(function() {
          const input = $(this).closest('.password-field').find('input');
          const icon = $(this).find('i');
          
          if (input.attr('type') === 'password') {
            input.attr('type', 'text');
            icon.removeClass('fa-eye').addClass('fa-eye-slash');
          } else {
            input.attr('type', 'password');
            icon.removeClass('fa-eye-slash').addClass('fa-eye');
          }
        });
    
        // Clear invalid state on input
        $('input, select').on('input change', function() {
          $(this).removeClass('is-invalid');
        });
      });
    </script>
    

  </body>
</html>
